import pandas as pd
import plotly.express as px
import streamlit as st

# ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
df = pd.read_csv("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£ + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢.csv")
df['Date'] = pd.to_datetime(df['Date'])
df = df.rename(columns={'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô(1)/(2)*100': '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£'})

# ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤
st.title("‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£ (%)")

# ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
option = st.radio(
    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:",
    ("3 ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î", "5 ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î", "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"),
    horizontal=True
)

# ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
if option == "3 ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î":
    latest_date = df['Date'].max()
    start_date = latest_date - pd.DateOffset(years=3)
    df_filtered = df[df['Date'] >= start_date]
elif option == "5 ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î":
    latest_date = df['Date'].max()
    start_date = latest_date - pd.DateOffset(years=5)
    df_filtered = df[df['Date'] >= start_date]
else:
    df_filtered = df

# ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü
fig = px.line(
    df_filtered,
    x='Date',
    y='‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£',
    title='‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£',
    markers=True,
    labels={'Date': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£': '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (%)'}
)
fig.update_layout(yaxis_tickformat=".2f")
st.plotly_chart(fig, use_container_width=True)

# ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
st.subheader("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á")
st.dataframe(df_filtered.style.format({'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£': '{:.2f}'}), use_container_width=True)

# ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
csv = df_filtered.to_csv(index=False)
st.download_button(
    label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á",
    data=csv,
    file_name=f"‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ï‡πà‡∏≠‡∏ò‡∏ô‡∏ö‡∏±‡∏ï‡∏£_{option}.csv",
    mime='text/csv'
)
