import streamlit as st
import pandas as pd
import plotly.express as px

def render():
    data = [
        # ข้อมูลปี 2557 - 2560 (คงเดิม)
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 4.4204},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "10 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 3.5592},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.9672},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "5 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 2.7468},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "2 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 1.7183},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.7314},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.6027},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3981},
        {"ปีงบประมาณ": 2557, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2859},
        
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 4.6036},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "10 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 3.543},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.2329},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "5 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 2.7616},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.7847},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.9549},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.7068},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3888},
        {"ปีงบประมาณ": 2558, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.31},

        # ... (คงข้อมูลปี 2559-2560 ไว้เช่นเดิม) ...

        # เพิ่มข้อมูลปี 2561 - 2568
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.8266},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "10 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 3.7657},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.7859},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "5 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 2.7382},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.4948},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "2 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 1.4535},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.7375},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.6008},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.4248},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3558},
        {"ปีงบประมาณ": 2561, "ชนิดราคา": "25 สตางค์", "แบบ": "เพิ่มเติม", "ต้นทุน": 1.2461},

        {"ปีงบประมาณ": 2562, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.6529},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "10 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 3.4698},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.788},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "5 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 2.5927},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.4723},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.5263},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3022},
        {"ปีงบประมาณ": 2562, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2546},

        {"ปีงบประมาณ": 2563, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.5921},
        {"ปีงบประมาณ": 2563, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.677},
        {"ปีงบประมาณ": 2563, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.4724},
        {"ปีงบประมาณ": 2563, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.6346},
        {"ปีงบประมาณ": 2563, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.5314},
        {"ปีงบประมาณ": 2563, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3063},
        {"ปีงบประมาณ": 2563, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2579},

        {"ปีงบประมาณ": 2564, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.8855},
        {"ปีงบประมาณ": 2564, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.8398},
        {"ปีงบประมาณ": 2564, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.5053},
        {"ปีงบประมาณ": 2564, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.583},
        {"ปีงบประมาณ": 2564, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.4706},
        {"ปีงบประมาณ": 2564, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2997},
        {"ปีงบประมาณ": 2564, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2517},

        {"ปีงบประมาณ": 2565, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.9501},
        {"ปีงบประมาณ": 2565, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.8854},
        {"ปีงบประมาณ": 2565, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.5357},
        {"ปีงบประมาณ": 2565, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.6058},
        {"ปีงบประมาณ": 2565, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.4922},
        {"ปีงบประมาณ": 2565, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.317},
        {"ปีงบประมาณ": 2565, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2654},

        {"ปีงบประมาณ": 2566, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 5.4039},
        {"ปีงบประมาณ": 2566, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.7078},
        {"ปีงบประมาณ": 2566, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.0372},
        {"ปีงบประมาณ": 2566, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 0.9433},
        {"ปีงบประมาณ": 2566, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.4589},
        {"ปีงบประมาณ": 2566, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3485},
        {"ปีงบประมาณ": 2566, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.2812},

        {"ปีงบประมาณ": 2567, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 5.5859},
        {"ปีงบประมาณ": 2567, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.9593},
        {"ปีงบประมาณ": 2567, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.1737},
        {"ปีงบประมาณ": 2567, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.0063},
        {"ปีงบประมาณ": 2567, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.512},
        {"ปีงบประมาณ": 2567, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3949},
        {"ปีงบประมาณ": 2567, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3299},

        {"ปีงบประมาณ": 2568, "ชนิดราคา": "10 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 5.5859},
        {"ปีงบประมาณ": 2568, "ชนิดราคา": "5 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 3.9593},
        {"ปีงบประมาณ": 2568, "ชนิดราคา": "2 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 2.1737},
        {"ปีงบประมาณ": 2568, "ชนิดราคา": "1 บาท", "แบบ": "ตัวเปล่า", "ต้นทุน": 1.0063},
        {"ปีงบประมาณ": 2568, "ชนิดราคา": "1 บาท", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.512},
        {"ปีงบประมาณ": 2568, "ชนิดราคา": "50 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3949},
        {"ปีงบประมาณ": 2568, "ชนิดราคา": "25 สตางค์", "แบบ": "สำเร็จรูป", "ต้นทุน": 0.3299},
    ]


    # สมมุติว่าคุณโหลดตัวแปร `data` มาจากไฟล์หรือ Canvas แล้ว
    df = pd.DataFrame(data)

    st.title("📊 แผนประมาณการต้นทุนผลิตเหรียญกษาปณ์")

    # ตัวเลือกชนิดราคา และประเภทเหรียญ
    selected_types = st.multiselect("เลือกชนิดราคา", sorted(df["ชนิดราคา"].unique()), default=sorted(df["ชนิดราคา"].unique()))
    selected_styles = st.multiselect("เลือกประเภทเหรียญ", sorted(df["แบบ"].unique()), default=sorted(df["แบบ"].unique()))

    # Checkbox แสดงตัวเลขบนเส้น
    show_labels = st.checkbox("📌 แสดงค่าต้นทุนบนจุด", value=True)

    filtered_df = df[df["ชนิดราคา"].isin(selected_types) & df["แบบ"].isin(selected_styles)]

    # เพิ่มคอลัมน์ text เฉพาะเมื่อจะแสดงตัวเลข
    if show_labels:
        fig = px.line(
            filtered_df,
            x="ปีงบประมาณ",
            y="ต้นทุน",
            color="ชนิดราคา",
            line_dash="แบบ",
            text="ต้นทุน",
            markers=True,
            labels={"ต้นทุน": "ต้นทุนต่อเหรียญ (บาท)", "ปีงบประมาณ": "ปีงบประมาณ"},
            title="แนวโน้มต้นทุนการผลิตเหรียญรายปี"
        )
        fig.update_traces(textposition="top center")
    else:
        fig = px.line(
            filtered_df,
            x="ปีงบประมาณ",
            y="ต้นทุน",
            color="ชนิดราคา",
            line_dash="แบบ",
            markers=True,
            labels={"ต้นทุน": "ต้นทุนต่อเหรียญ (บาท)", "ปีงบประมาณ": "ปีงบประมาณ"},
            title="แนวโน้มต้นทุนการผลิตเหรียญรายปี"
        )

    st.plotly_chart(fig, use_container_width=True)

    # แสดงตารางข้อมูล
    with st.expander("📋 ดูตารางข้อมูล"):
        st.dataframe(filtered_df, use_container_width=True)
        csv = filtered_df.to_csv(index=False).encode("utf-8-sig")
        st.download_button("📥 ดาวน์โหลดตารางข้อมูล", data=csv, file_name="ต้นทุนการผลิต.csv", mime="text/csv")