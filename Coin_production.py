import streamlit as st
import pandas as pd
import plotly.graph_objects as go
import plotly.express as px

def render():
    data_dict = {
        "‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤": ["10 ‡∏ö‡∏≤‡∏ó", "5 ‡∏ö‡∏≤‡∏ó", "2 ‡∏ö‡∏≤‡∏ó", "1 ‡∏ö‡∏≤‡∏ó", "50 ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå", "25 ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå", 
                "10 ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå *", "5 ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå *", "1 ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå *", "‡∏£‡∏ß‡∏°"],

        "2568_‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢": [30, 70, 10, 680, 40, 70, 0.05, 0.05, 0.05, 900.15],
        "2568_‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á": [4.2, 69.95, 1, 287.4, 100, 100, 0, 0, 0, 562.55],

        "2567_‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢": [40, 95, 10, 385, 55, 120, 0.05, 0.05, 0.05, 705.15],
        "2567_‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á": [40, 95, 10, 465, 210, 510, 0.05, 0.05, 0.05, 1330.15],

        "2566_‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢": [55, 145, 35, 575, 90, 175, 0.05, 0.05, 0.05, 1075.15],
        "2566_‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á": [55, 145, 35, 620, 300, 100, 0.05, 0.05, 0.05, 1255.15],

        "2565_‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢": [50, 190, 10, 625, 100, 200, 0.05, 0.05, 0.05, 1175.15],
        "2565_‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á": [50, 190, 10, 885, 150, 375, 0.05, 0.05, 0.05, 1660.15],

        "2564_‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢": [155, 275, 40, 810, 140, 250, 0.05, 0.05, 0.05, 1670.15],
        "2564_‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á": [155, 275, 40, 460.35, 50, 200, 0.05, 0.05, 0.05, 1180.5],
    }

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á DataFrame
    df = pd.DataFrame(data_dict)

    # ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß '‡∏£‡∏ß‡∏°' ‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
    df_no_total = df[df["‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤"] != "‡∏£‡∏ß‡∏°"]

    # ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö facet
    records = []
    years = ["2568", "2567", "2566", "2565", "2564"]
    for year in years:
        for idx, row in df_no_total.iterrows():
            records.append({
                "‡∏õ‡∏µ": year,
                "‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤": row["‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤"],
                "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó": "‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢",
                "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô": row[f"{year}_‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢"]
            })
            records.append({
                "‡∏õ‡∏µ": year,
                "‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤": row["‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤"],
                "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó": "‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á",
                "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô": row[f"{year}_‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á"]
            })

    long_df = pd.DataFrame(records)

    # Streamlit layout
    st.title("üìä ‡πÅ‡∏ú‡∏ô-‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Å‡∏©‡∏≤‡∏õ‡∏ì‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ")

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü facet
    fig = px.bar(
        long_df,
        x="‡∏õ‡∏µ",
        y="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô",
        color="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó",
        facet_col="‡∏ä‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤",
        barmode="group",
        title="üìä ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏µ",
        category_orders={"‡∏õ‡∏µ": sorted(long_df["‡∏õ‡∏µ"].unique(), reverse=True)}
    )
    fig.update_layout(height=800)

    st.plotly_chart(fig, use_container_width=True)

    # ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô expander
    with st.expander("üìã ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"):
        st.dataframe(df, use_container_width=True)
